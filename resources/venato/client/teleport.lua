local TeleportFromTo = {
  ["Maze Bank Building"] = {
    positionFrom = { ['x'] = -68.7212, ['y'] = -801.0262, ['z'] = 44.2273, nom = "Toit - Maze Bank Building" },
    positionTo = { ['x'] = -67.6794, ['y'] = -821.6484, ['z'] = 321.2873, nom = "Decendre - Maze Bank Building" },
    whitelist = false,
  },

  ["Humane Labs"] = {
    positionFrom = { ['x'] = 3541.7028, ['y'] = 3674.2761, ['z'] = 28.1211, nom = "Descendre - Humane labs" },
    positionTo = { ['x'] = 3541.7314, ['y'] = 3674.2619, ['z'] = 20.9917, nom = "Monter - Humane labs" },
    whitelist = false,
  },

  ["Arcadius Buisiness"] = {
    positionFrom = { ['x'] = -117.2135, ['y'] = -604.5497, ['z'] = 36.2807, nom = "Monter - Arcadius Buisiness" },
    positionTo = { ['x'] = -134.0843, ['y'] = -584.5471, ['z'] = 201.7355, nom = "Descendre - Arcadius Buisiness" },
    whitelist = false,
  },

  --["Oneway Police"] = {
  --positionFrom = { ['x'] = -2004.339, ['y'] = 3196.713, ['z'] = -36.262, nom = "Entrer - Oneway Police"},
  --positionTo = { ['x'] = 446.325, ['y'] = -986.341, ['z'] = 26.674, nom = "Sortir - Oneway Police"},
  --},

  --["Oneway Police Suspect"] = {
  --positionFrom = { ['x'] = -2008.059, ['y'] = 3184.345, ['z'] = -36.262, nom = "Entrer - Oneway Police Suspect"},
  --positionTo = { ['x'] = 465.123, ['y'] = -990.162, ['z'] = 24.945, nom = "Sortir - Oneway Police Suspect"},
  --},
  ["Entrepot Boisson"] = {
    positionFrom = { ['x'] = -1546.95, ['y'] = -560.99, ['z'] = 33.72, nom = "Intérieur - Entrepot Boisson" },
    positionTo = { ['x'] = 1105.11, ['y'] = -3099.35, ['z'] = -39.1, nom = "Sortir - Entrepot" },
  },
  ["Entrepot Nourriture"] = {
    positionFrom = { ['x'] = 496.17, ['y'] = -638.62, ['z'] = 25.03, nom = "Intérieur - Entrepot Nourriture" },
    positionTo = { ['x'] = 1072.94, ['y'] = -3102.6, ['z'] = -39.1, nom = "Sortir - Entrepot" },
  },
  ["Entrepot Divers"] = {
    positionFrom = { ['x'] = 2703.99, ['y'] = 3457.46, ['z'] = 55.55, nom = "Intérieur - Entrepot Divers" },
    positionTo = { ['x'] = 1026.86, ['y'] = -3101.61, ['z'] = -39.1, nom = "Sortir - Entrepot" },
  },

  ["Bureau du FIB"] = {
    positionFrom = { ['x'] = 136.0994, ['y'] = -761.8452, ['z'] = 45.7520, nom = "Monter - Bureau de MerryWeather" },
    positionTo = { ['x'] = 136.7892, ['y'] = -761.4996, ['z'] = 242.1518, nom = "Descendre - Bureau de MerryWeather" },
    whitelist = false,
  },

  ["Hôpital - Entrer - sortir"] = {
    positionFrom = { ['x'] = 1151.024, ['y'] = -1529.941, ['z'] = 35.373, nom = "Entrer - Hôpital" },
    positionTo = { ['x'] = 1146.779, ['y'] = -1560.052, ['z'] = 4.945, nom = "Sortir - Hôpital" },
    whitelist = false,
  },

  ["Hôpital - Entrer - sortir"] = {
    positionFrom = { ['x'] = 1838.427, ['y'] = 3673.369, ['z'] = 34.277, nom = "Entrer - Hôpital" },
    positionTo = { ['x'] = 1845.732, ['y'] = 3670.156, ['z'] = -3.282, nom = "Sortir - Hôpital" },
    whitelist = false,
  },

  ["Hôpital garage - Entrer - sortir"] = {
    positionFrom = { ['x'] = 1132.591, ['y'] = -1597.225, ['z'] = 34.733, nom = "Entrer - Hôpital" },
    positionTo = { ['x'] = 1136.334, ['y'] = -1594.335, ['z'] = 4.945, nom = "Sortir arrière Hôpital" },
    whitelist = false,
  },

  ["Life invader - Réunion"] = {
    positionFrom = { ['x'] = -1048.93, ['y'] = -238.589, ['z'] = 44.0211, nom = "Entrer - Salle de réunion" },
    positionTo = { ['x'] = -1046.62, ['y'] = -237.523, ['z'] = 44.0211, nom = "Sortir - Salle de réunion" },
    whitelist = false,
  },

  ["Life invader - Brainstorming"] = {
    positionFrom = { ['x'] = -1056.73, ['y'] = -237.844, ['z'] = 44.0212, nom = "Entrer - Salle de brainstorming" },
    positionTo = { ['x'] = -1057.85, ['y'] = -235.752, ['z'] = 44.0212, nom = "Sortir - Salle de brainstorming" },
    whitelist = false,
  },

  --	["Poste de police - Armurie"] = {
  --		positionFrom = { ['x'] = 452.227, ['y'] = -982.609, ['z'] = 30.6896, nom = "Entrer - Armurie"},
  --		positionTo = { ['x'] = 454.494, ['y'] = -982.571, ['z'] = 30.6896, nom = "Sortir - Armurie"},
  --	},

  -- ["Gruppe6 - Bureau"] = {
  --   positionFrom = { ['x'] = -1011.65, ['y'] = -480.061, ['z'] = 39.9706, nom = "Entrer - Agence H2BA" },
  --   positionTo = { ['x'] = -1002.81, ['y'] = -477.794, ['z'] = 50.0273, nom = "Sortir - Agence H2BA" },
  --   whitelist = false,
  -- },

  ["Gouvernement"] = {
    positionFrom = { ['x'] = -429.32, ['y'] = 1110.22, ['z'] = 327.68, nom = "Entrer - Gouvernement" },
    positionTo = { ['x'] = -141.25, ['y'] = -613.84, ['z'] = 168.82, nom = "Sortir - Gouvernement" },
    whitelist = false,
  },

  ["Labo"] = {
    positionFrom = { ['x'] = 3514.0, ['y'] = 3755.0, ['z'] = 30.0, nom = "Entrer - Labo" },
    positionTo = { ['x'] = 3527.0, ['y'] = 3674.0, ['z'] = 28.5, nom = "Sortir - Labo" },
    whitelist = false,
  },

  ["AlphaCorp - Bureau"] = {
    positionFrom = { ['x'] = -1581.423706, ['y'] = -558.146667, ['z'] = 34.953056, nom = "Entrer - Bureau Gruppe6" },
    positionTo = { ['x'] = -1581.293823, ['y'] = -562.1727905, ['z'] = 108.5229339, nom = "Sortir - Rue" },
    whitelist = false,
  },

  ["AlphaCorp - Parking"] = {
    positionFrom = { ['x'] = -1536.5893554, ['y'] = -579.018127, ['z'] = 25.7077922, nom = "Entrer - Bureau Gruppe6" },
    positionTo = { ['x'] = -1579.411376, ['y'] = -564.9171142, ['z'] = 108.5229339, nom = "Sortir - Parking" },
    whitelist = false,
  },

  ["Bureau mecano"] = {
    positionFrom = { ['x'] = -355.2135, ['y'] = -143.5497, ['z'] = 42.2807, nom = "Entrer - Bureau mecano" },
    positionTo = { ['x'] = -774.0843, ['y'] = 332.5471, ['z'] = 208.0, nom = "Sorti - Bureau mecano" },
    whitelist = false,
  },

  ["Chambre Franklin2"] = {
    positionFrom = { ['x'] = -9.726, ['y'] = 531.298, ['z'] = 170.617, nom = "Entrer - Chambre" },
    positionTo = { ['x'] = -6.200, ['y'] = 526.925, ['z'] = 170.626, nom = "Sorti - Chambre" },
    whitelist = false,
  },

  --["Biker"] = {
  --positionFrom = { ['x'] = 904.13757324219, ['y'] = 3560.0534667969, ['z'] = 33.807735443115, nom = "Entrer"},
  --positionTo = { ['x'] = 997.123, ['y'] = -3158.234, ['z'] = -38.907, nom = "Sorti"},
  --},

  --["WeedBV"] = {
  --positionFrom = { ['x'] = -1579.649, ['y'] = 768.982, ['z'] = 189.194, nom = "Entrer"},
  --positionTo = { ['x'] = 1066.334, ['y'] = -3183.500, ['z'] = -39.16, nom = "Sorti"},
  --},

  --["PaperFake"] = {
  --positionFrom = { ['x'] = 733.0373, ['y'] = 2523.3198, ['z'] = 73.2238, nom = "Entrer"},
  --positionTo = { ['x'] = 1173.3039, ['y'] = -3196.7138, ['z'] = -39.007, nom = "Sorti"},
  --},


  -- ["sorti teki"] = {
  --   positionFrom = { ['x'] = -568.53, ['y'] = 291.247, ['z'] = 79.176, nom = "" },
  --   positionTo = { ['x'] = -493.283, ['y'] = 225.878, ['z'] = 24.10, nom = "" },
  --   whitelist = false,
  -- },

  ["Tribunal"] = {
    positionFrom = { ['x'] = 269.837, ['y'] = -433.134, ['z'] = 45.255, nom = "Entrer" },
    positionTo = { ['x'] = 264.554, ['y'] = -431.548, ['z'] = 21.238, nom = "Sorti" },
    whitelist = false,
  },

  ["Taxi"] = {
    positionFrom = { ['x'] = 895.616, ['y'] = -179.429, ['z'] = 74.700, nom = "Entrer - Bureau Taxi" },
    positionTo = { ['x'] = -1388.507, ['y'] = -483.361, ['z'] = 78.200, nom = "Sorti - Parking Taxi" },
    whitelist = false,
  },

  ["lsNews"] = {
    positionFrom = { ['x'] = -317.92, ['y'] = -610.21, ['z'] = 33.558, nom = "Entrer bureaux" },
    positionTo = { ['x'] = -78.514, ['y'] = -832.07, ['z'] = 243.385, nom = "Sortir des bureaux" },
    whitelist = false,
  },

  ["Shadow"] = {
    positionFrom = { ['x'] = -97.749, ['y'] = 988.562, ['z'] = 235.756, nom = "Entrer Maison" },
    positionTo = { ['x'] = -664.845, ['y'] = -980.995, ['z'] = -39.800, nom = "Sortir de la Maison" },
    whitelist = false,
  },

  --["Bloods"] = {
  --positionFrom = { ['x'] = -1075.776, ['y'] = -1645.380, ['z'] = 4.501, nom = "Entrer de l appartement"},
  --positionTo = { ['x'] = -948.723, ['y'] = -1088.200, ['z'] = -39.800, nom = "Sortir de l appartement"},
  --},

  --["Bigness"] = {
  --positionFrom = { ['x'] = -212.746, ['y'] = -1617.487, ['z'] = 38.054, nom = "Entrer Planque"},
  --positionTo = { ['x'] = -108.922, ['y'] = -8.547, ['z'] = 70.519, nom = "Sortir de la Planque"},
  --},

  ["Event Horloge"] = {
    positionFrom = { ['x'] = -1237.066, ['y'] = -828.687, ['z'] = 25.128, nom = "Entrer" },
    positionTo = { ['x'] = -1253.681, ['y'] = -842.833, ['z'] = 65.331, nom = "Sortir" },
    whitelist = false,
  },

  ["Night Club"] = {
    positionFrom = { ['x'] = 757.997009, ['y'] = -1332.661865, ['z'] = 27.275236, nom = "Entrer du NightClub" },
    positionTo = { ['x'] = -1569.412109, ['y'] = -3017.339843, ['z'] = -74.4061508, nom = "Sortir du NightClub" },
    whitelist = false,
  },

  ["Unicorn"] = {
    positionFrom = { ['x'] = 138.402, ['y'] = -1292.915, ['z'] = 29.233, nom = "Bar"},
    positionTo = { ['x'] = 124.762, ['y'] = -1279.882, ['z'] = 29.27, nom = "Dehors" },
    whitelist = true,
    jobId = 34
  },

  ["Bahama Mamas Bar 1"] = {
    positionFrom = { ['x'] = -1389.297, ['y'] = -592.065, ['z'] = 30.32, nom = "Entrée Bar 1"},
    positionTo = { ['x'] = -1390.226, ['y'] = -600.315, ['z'] = 30.32, nom = "Sortir" },
    whitelist = true,
    jobId = 35
  },

  ["Bahama Mamas Bar 2"] = {
    positionFrom = { ['x'] = -1386.12, ['y'] = -627.629, ['z'] = 30.82, nom = "Entrée Bar 2"},
    positionTo = { ['x'] = -1371.232, ['y'] = -625.838, ['z'] = 30.32, nom = "Sortir" },
    whitelist = true,
    jobId = 35
  },

  ["Garage Palace Entree"] = {
    positionFrom = { ['x'] = 732.28, ['y'] = -1291.37, ['z'] = 25.28, nom = "Parking Palace"},
    positionTo = { ['x'] = -1641.64, ['y'] = -2989.70, ['z'] = -77.45, ['h'] = 268.86, nom = "Sortir" },
    acceptVehicle = true,    
    hideTo = true,
    distance = 5
  },

  ["Garage Palace Sortie"] = {
    positionFrom = { ['x'] = -1641.29, ['y'] = -3012.52, ['z'] = -78.54, nom = "Sortie"},
    positionTo = { ['x'] = 730.25, ['y'] = -1284.72, ['z'] = 25.89, ['h'] = 93.42, nom = "Parking Palace"},
    acceptVehicle = true,
    hideTo = true,
    distance = 5
  },

  ["Tequilala"] = {
    positionFrom = { ['x'] = -561.61, ['y'] = 289.80, ['z'] = 82.18, nom = "Entrée bar VIP"},
    positionTo = { ['x'] = -564.85, ['y'] = 284.65, ['z'] = 85.38, nom = "Sortir" },
    whitelist = true,
    jobId = 23,
    distance = 0.5
  },

}

local entities = {}
Drawing = setmetatable({}, Drawing)
Drawing.__index = Drawing

RegisterNetEvent("Teleport:SetTeleport")
AddEventHandler("Teleport:SetTeleport", function(name, teleport)
  TeleportFromTo[name] = teleport
end)

RegisterNetEvent("Teleport:RemoveTeleport")
AddEventHandler("Teleport:RemoveTeleport", function(name)
  TeleportFromTo[name] = nil
end)

function Drawing.draw3DText(x, y, z, textInput, fontId, scaleX, scaleY, r, g, b, a)
  local px, py, pz = table.unpack(GetGameplayCamCoords())
  local dist = GetDistanceBetweenCoords(px, py, pz, x, y, z, 1)

  local scale = (1 / dist) * 20
  local fov = (1 / GetGameplayCamFov()) * 100
  local scale = scale * fov

  SetTextScale(scaleX * scale, scaleY * scale)
  SetTextFont(fontId)
  SetTextProportional(1)
  SetTextColour(r, g, b, a)
  SetTextDropshadow(0, 0, 0, 0, 255)
  SetTextEdge(2, 0, 0, 0, 150)
  SetTextDropShadow()
  SetTextOutline()
  SetTextEntry("STRING")
  SetTextCentre(1)
  AddTextComponentString(textInput)
  SetDrawOrigin(x, y, z + 2, 0)
  DrawText(0.0, 0.0)
  ClearDrawOrigin()
end

function Drawing.drawMissionText(m_text, showtime)
  ClearPrints()
  SetTextEntry_2("STRING")
  AddTextComponentString(m_text)
  DrawSubtitleTimed(showtime, 1)
end

function msginf(msg, duree)
  duree = duree or 500
  ClearPrints()
  SetTextEntry_2("STRING")
  AddTextComponentString(msg)
  DrawSubtitleTimed(duree, 1)
end

Citizen.CreateThread(function()
  while true do
    Citizen.Wait(0)
    local pos = GetEntityCoords(Venato.GetPlayerPed(), true)
    local canGoIn = false

    for k, j in pairs(TeleportFromTo) do
     
      if (Vdist(pos.x, pos.y, pos.z, j.positionFrom.x, j.positionFrom.y, j.positionFrom.z) < 150.0) and (not j.whitelist or (j.whitelist and Venato.HasJob(j.jobId)))  then
        DrawMarker(1, j.positionFrom.x, j.positionFrom.y, j.positionFrom.z - 1, 0, 0, 0, 0, 0, 0, 1.0001, 1.0001, .101,
          255, 255, 255, 255, 0, 0, 0, 0)
        if (Vdist(pos.x, pos.y, pos.z, j.positionFrom.x, j.positionFrom.y, j.positionFrom.z) < 5.0) then
          Drawing.draw3DText(j.positionFrom.x, j.positionFrom.y, j.positionFrom.z - 1.100, j.positionFrom.nom, 1, 0.2,
            0.1, 255, 255, 255, 215)
          if (Vdist(pos.x, pos.y, pos.z, j.positionFrom.x, j.positionFrom.y, j.positionFrom.z) < (j.distance ~= nil and j.distance or 2.0) ) then
            ClearPrints()
            SetTextEntry_2("STRING")
            AddTextComponentString("Appuyez sur la touche ~r~E~w~ pour " .. j.positionFrom.nom)
            DrawSubtitleTimed(2000, 1)
            if IsControlJustPressed(1, 38) then
              canGoIn = true
              local curVehicule = GetVehiclePedIsIn(Venato.GetPlayerPed(), false)
              if curVehicule ~= 0 then
                if not j.acceptVehicle then
                  Venato.notifyError("Vous ne pouvez pas rentrer avec votre véhicule")        
                  canGoIn = false          
                end
              end
              if canGoIn then
                DoScreenFadeOut(500)
                Citizen.Wait(1000)
                FreezeEntityPosition(Venato.GetPlayerPed(), true)
                SetEntityCoords(Venato.GetPlayerPed(), j.positionTo.x, j.positionTo.y, j.positionTo.z - 1)
                if curVehicule ~= 0 then
                  entities = {}
                  for i = 0, GetVehicleMaxNumberOfPassengers(vehicle) do
                    entities[i] = GetPedInVehicleSeat(curVehicule, i)
                  end
                  SetEntityCoords(curVehicule, j.positionTo.x, j.positionTo.y, j.positionTo.z - 1)
                  SetPedIntoVehicle(Venato.GetPlayerPed(), curVehicule, -1)
                  SetEntityHeading(curVehicule, j.positionTo.h)
                  for i = 0, GetVehicleMaxNumberOfPassengers(vehicle) do
                    if entities[i] then
                      SetPedIntoVehicle(entities[i], curVehicule, i)
                    end
                  end
                end
                if j.insideModer then
                
                end
                Citizen.Wait(500)
                DoScreenFadeIn(1000)
                FreezeEntityPosition(Venato.GetPlayerPed(), false)
              end
            end
          end
        end
      end

      if (Vdist(pos.x, pos.y, pos.z, j.positionTo.x, j.positionTo.y, j.positionTo.z) < 150.0 and not j.hideTo) then
        DrawMarker(1, j.positionTo.x, j.positionTo.y, j.positionTo.z - 1, 0, 0, 0, 0, 0, 0, 1.0001, 1.0001, .101, 255,
          255, 255, 255, 0, 0, 0, 0)
        if (Vdist(pos.x, pos.y, pos.z, j.positionTo.x, j.positionTo.y, j.positionTo.z) < 5.0) then
          Drawing.draw3DText(j.positionTo.x, j.positionTo.y, j.positionTo.z - 1.100, j.positionTo.nom, 1, 0.2, 0.1, 255,
            255, 255, 215)
          if (Vdist(pos.x, pos.y, pos.z, j.positionTo.x, j.positionTo.y, j.positionTo.z) < (j.distance ~= nil and j.distance or 2.0)) then
            ClearPrints()
            SetTextEntry_2("STRING")
            AddTextComponentString("Appuyez sur la touche ~r~E~w~ pour " .. j.positionTo.nom)
            DrawSubtitleTimed(2000, 1)
            if IsControlJustPressed(1, 38) then
              DoScreenFadeOut(1000)
              Citizen.Wait(1000)
              FreezeEntityPosition(Venato.GetPlayerPed(), true)
              SetEntityCoords(Venato.GetPlayerPed(), j.positionFrom.x, j.positionFrom.y, j.positionFrom.z - 1)
              Citizen.Wait(2000)
              DoScreenFadeIn(1000)
              FreezeEntityPosition(Venato.GetPlayerPed(), false)
            end
          end
        end
      end
    end
  end
end)
