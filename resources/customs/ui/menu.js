let pearlescentColor = [
	{n1: "Black"},
	{n1: "Graphite"},
	{n1: "Black Steel"},
	{n1: "Dark Steel"},
	{n1: "Silver"},
	{n1: "Bluish Silver"},
	{n1: "Rolled Steel"},
	{n1: "Shadow Silver"},
	{n1: "Stone Silver"},
	{n1: "Midnight Silver"},
	{n1: "Cast Iron Silver"},
	{n1: "Anthracite Black"},
	{n1: "Matte Black"},
	{n1: "Matte Gray"},
	{n1: "Light Gray"},
	{n1: "Util Black"},
	{n1: "Util Black Poly"},
	{n1: "Util Dark Silver"},
	{n1: "Util Silver"},
	{n1: "Util Gun Metal"},
	{n1: "Util Shadow Silver"},
	{n1: "Worn Black"},
	{n1: "Worn Graphite"},
	{n1: "Worn Silver Grey"},
	{n1: "Worn Silver"},
	{n1: "Worn Blue Silver"},
	{n1: "Worn Shadow Silver"},
	{n1: "Red"},
	{n1: "Torino Red"},
	{n1: "Formula Red"},
	{n1: "Blaze Red"},
	{n1: "Grace Red"},
	{n1: "Garnet Red"},
	{n1: "Sunset Red"},
	{n1: "Cabernet Red"},
	{n1: "Candy Red"},
	{n1: "Sunrise Orange"},
	{n1: "Gold"},
	{n1: "Orange"},
	{n1: "Red"},
	{n1: "Dark Red"},
	{n1: "Matte Orange"},
	{n1: "Yellow"},
	{n1: "Util Red"},
	{n1: "Util Bright Red"},
	{n1: "Util Garnet Red "},
	{n1: "Worn Red"},
	{n1: "Worn Golden Red"},
	{n1: "Worn Dark Red"},
	{n1: "Dark Green"},
	{n1: "Metallic Racing Green"},
	{n1: "Sea Green"},
	{n1: "Olive Green"},
	{n1: "Bright Green"},
	{n1: "Metallic Gasoline Green"},
	{n1: "Matte Lime Green"},
	{n1: "Dark Green"},
	{n1: "Worn Green"},
	{n1: "Worn Sea Wash"},
	{n1: "Metallic Midnight Blue"},
	{n1: "Metallic Dark Blue"},
	{n1: "Galaxy Blue"},
	{n1: "Dark Blue"},
	{n1: "Saxon Blue"},
	{n1: "Blue"},
	{n1: "Mariner Blue"},
	{n1: "Harbor Blue"},
	{n1: "Diamond Blue"},
	{n1: "Surf Blue"},
	{n1: "Nautical Blue"},
	{n1: "Ultra Blue"},
	{n1: "Schafter Purpler"},
	{n1: "Metallic Ultra Blue"},
	{n1: "Racing Blue"},
	{n1: "Light Blue"},
	{n1: "Util Midnight Blue"},
	{n1: "Util Blue"},
	{n1: "Util Sea Foam Blue"},
	{n1: "Util Lightning Blue"},
	{n1: "Util Maui Blue Poly"},
	{n1: "Util Bright Blue"},
	{n1: "Slate Blue"},
	{n1: "Dark Blue"},
	{n1: "Blue"},
	{n1: "Matte Midnight Blue"},
	{n1: "Worn Dark Blue"},
	{n1: "Worn Blue"},
	{n1: "Baby Blue"},
	{n1: "Yellow"},
	{n1: "Race Yellow"},
	{n1: "Bronze"},
	{n1: "Dew Yellow"},
	{n1: "Metallic Lime"},
	{n1: "Metallic Champagne"},
	{n1: "Feltzer Brown"},
	{n1: "Creek Brown"},
	{n1: "Chocolate Brown"},
	{n1: "Maple Brown"},
	{n1: "Saddle Brown"},
	{n1: "Straw Brown"},
	{n1: "Moss Brown"},
	{n1: "Bison Brown"},
	{n1: "Woodbeech Brown"},
	{n1: "Beechwood Brown"},
	{n1: "Straw Brown"},
	{n1: "Sandy Brown"},
	{n1: "Bleached Brown"},
	{n1: "Cream"},
	{n1: "Util Brown"},
	{n1: "Util Medium Brown"},
	{n1: "Util Light Brown"},
	{n1: "Ice White"},
	{n1: "Frost White"},
	{n1: "Worn Honey Beige"},
	{n1: "Worn Brown"},
	{n1: "Dark Brown"},
	{n1: "Worn Straw Beige"},
	{n1: "Brushed Steel "},
	{n1: "Brushed Black Steel"},
	{n1: "Brushed Alluminum"},
	{n1: "Chrome"},
	{n1: "Worn Off-White"},
	{n1: "Util Off-White"},
	{n1: "Worn Orange"},
	{n1: "Worn Light Orange"},
	{n1: "Pea Green"},
	{n1: "Worn Taxi Yellow"},
	{n1: "Police Blue"},
	{n1: "Green"},
	{n1: "Matte Brown"},
	{n1: "Worn Orange"},
	{n1: "Ice White"},
	{n1: "Worn White"},
	{n1: "Worn Olive Army Green"},
	{n1: "Pure White"},
	{n1: "Hot Pink"},
	{n1: "Salmon Pink"},
	{n1: "Pfister Pink"},
	{n1: "Bright Orange"},
	{n1: "Green"},
	{n1: "Flourescent Blue"},
	{n1: "Midnight Blue"},
	{n1: "Midnight Purple"},
	{n1: "Wine Red"},
	{n1: "Hunter Green"},
	{n1: "Bright Purple"},
	{n1: "Midnight Purple"},
	{n1: "Carbon Black"},
	{n1: "Matte Purple"},
	{n1: "Matte Dark Purple"},
	{n1: "Metallic Lava Red"},
	{n1: "Olive Green"},
	{n1: "Matte Olive Drab"},
	{n1: "Dark Earth"},
	{n1: "Desert Tan"},
	{n1: "Matte Foilage Green"},
	{n1: "DEFAULT ALLOY"},
	{n1: "Epsilon Blue"},
	{n1: "Pure Gold"},
	{n1: "Brushed Gold"},
	{n1: "Secret Gold"}
];

let CustomPrice = {
	color: {
		primary: 2500,
		secondary: 1000,
		pearlescent: 2500,
		neons: 2500,
		tyreburst: 2500
	},
	wheels: {
		val_0: 4000,
		val_1: 4000,
		val_2: 4000,
		val_3: 4000,
		val_4: 4000,
		val_5: 4000,
		val_6: 4000,
		val_7: 4000,
		val_8: 4000,
	},
	windows: 500,
	xenons: 500,
	horn: 500,
	tyreburst: 1000,
	performance: {
		moteur: {
			val_0: 0,
			val_1: 22000,
			val_2: 32500,
			val_3: 62500,
			val_4: 102500
		},
		freins:{
			val_0: 0,
			val_1: 22000,
			val_2: 32500,
			val_3: 62500,
			val_4: 102500
		},
		transmission: {
			val_0: 0,
			val_1: 22000,
			val_2: 32500,
			val_3: 62500,
			val_4: 102500
		},
		suspension: {
			val_0: 0,
			val_1: 750,
			val_2: 1250,
			val_3: 2500,
			val_4: 3250
		},
		turbo: {
			val_0: 0,
			val_1: 50000
		}
	},
	mods: {
		mod_0: 2500,
		mod_1: 2500,
		mod_2: 2500,
		mod_3: 2500,
		mod_4: 2500,
		mod_5: 2500,
		mod_6: 2500,
		mod_7: 2500,
		mod_8: 2500,
		mod_9: 2500,
		mod_10: 2500,
		mod_19: 2500,
		mod_20: 2500,
		mod_21: 2500,
		mod_22: 2500,
		mod_23: 2500,
		mod_24: 2500,
		mod_25: 2500,
		mod_26: 2500,
		mod_27: 2500,
		mod_28: 2500,
		mod_29: 2500,
		mod_30: 2500,
		mod_31: 2500,
		mod_32: 2500,
		mod_33: 2500,
		mod_34: 2500,
		mod_35: 2500,
		mod_36: 2500,
		mod_37: 2500,
		mod_38: 2500,
		mod_39: 2500,
		mod_40: 2500,
		mod_41: 2500,
		mod_42: 2500,
		mod_43: 2500,
		mod_44: 2500,
		mod_45: 2500,
		mod_46: 2500,
		mod_47: 2500,
		mod_48: 2500,
		mod_49: 2500,
		mod_50: 2500
	}
};

configMods = {};
let currentVhl = {};
let on_m_per_km_converter =  0.277777777778;

function hexToRgb(str) {
	if ( /^#([0-9a-f]{3}|[0-9a-f]{6})$/ig.test(str)  ) {
		let hex = str.substr(1);
		hex = hex.length == 3 ? hex.replace(/(.)/g, '$1$1') : hex;
		let rgb = parseInt(hex, 16);
		return  {
			red: (rgb >> 16) & 255,
			green: (rgb >> 8) & 255,
			blue: rgb & 255
		};
	}
	return false;
}

function getCurrentIndex(){
	return store.getters.currentItem.index;
}

function itemArray(max){
	let a = [];
	for(let i = 0; i <= max; i++ ) {
		a.push({n1: i});
	}
	return a;
}

function setColorPickerMenuSelection(title, subtitle, action, type, typebdd){
	return {
		title: "<img src='static/img/header.png'>",
		subtitle: title,
		limit: 10,
		items: [
			{
				style: 'yellow button', key: 'Payer',
				value:'<img src="static/img/paid.png" />',
				help:"Prix: <span>" + (CustomPrice["color"][typebdd] * (type+1) ).toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1 ") + "</span> $",
				onChange:function(){ return false; },
				action:function(){ $.post("http://customs/pay", JSON.stringify({data: typebdd, type: type, price: CustomPrice["color"][typebdd] })); }
			}
		],
		stats: null,
		slider: null,
		colorPicker: {
			index:3,
			name:'Colors',
			onChange: function(item){
				let rgb = hexToRgb('#'+item);
				$.post("http://customs/"+action, JSON.stringify({red: rgb.red, green: rgb.green, blue: rgb.blue, type:type }))
			},
			colors:[
				'000000','191919','323232','4c4c4c','666666','7f7f7f','999999','b2b2b2','cccccc','e5e5e5','ffffff','a8adf5',
				'7a82f0', 'dcd4f8','dfc6fa','eed4f8','f7f9de','d4f8ee','f7dde9','e8f0f7','afcbe3' ,'faedf3' ,'ffe5f2' ,'d4f8ee' ,
				'e6dcf2' ,'7f487f' ,'a05ba0' ,'b266b2' ,'8e518e' ,'e55b5b' ,'5b5be5' ,'c3dbff' ,'d36331' ,'fec611' ,'851818' ,
				'ab1e1e' ,'392419' ,'b6fcd5' ,'d3ffce' ,'e2adf4' ,'adf4e7' , '5bead0' ,'98d7a7' ,'f67a70' ,'8cc7a1' ,'78a388' ,
				'ffd4b1' ,'d4aeb6' ,'d41c1c' ,'b8aefb' ,'dab4f4' ,'bae1e1' ,'b0e0e6','40BAE3', '6840E3', '30BF7F', '9FF23A',
				'3AF2EF', 'F2713A', 'F2463A', 'F2F07E', 'F255AE', '999095', '40BAE3', '6840E3', '30BF7F', '9FF23A',
				'3AF2EF', 'F2713A', 'F2463A', 'F2F07E', 'F255AE', '999095',
			]
		},
		grid: false,
		style: null,
		onItemChange:null,
		index: 0
	}
}

function setColorPickerMenu(title, subtitle, action, type, typebdd){
	return {
		title: "<img src='static/img/header.png'>",
		subtitle: title,
		limit: 10,
		items: [
			{ key: 'Selection', action: function(){ store.commit('SET_MENU', setColorPickerMenuSelection(title, "Selection", action, type, typebdd))} },
			{ key: 'RGB Perso ', action: function(){ store.commit('SET_MENU', RGBMenu(title, "RGB", action+"_rgb", type, typebdd))} }
		],
		stats: null,
		slider: null,
		colorPicker: null,
		grid: false,
		style: null,
		onItemChange:null,
		index: 0
	}
}

function RGBMenu(title, subtitle, action, type, typebdd){
	return {
		title: "<img src='static/img/header.png'>",
		subtitle: 'Couleur perso',
		limit: 10,
		items: [
			{ key: 'Rouge',value: itemArray(255),onChange: function(index){$.post("http://customs/"+action, JSON.stringify({red: index, type: type}))}},
			{ key: 'Vert',value: itemArray(255),onChange: function(index){$.post("http://customs/"+action, JSON.stringify({green: index, type: type}))}},
			{ key: 'Bleu',value: itemArray(255),onChange: function(index){$.post("http://customs/"+action, JSON.stringify({blue: index, type: type}))}},
			{ style: 'yellow button',
				help: "Prix: <span>" + CustomPrice["color"][typebdd].toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1 ") + "</span> $",
				key: 'Payer',
				value:'<img src="static/img/paid.png" />',
				action:function(){$.post("http://customs/pay", JSON.stringify({data: typebdd, type: type, price: CustomPrice["color"][typebdd]})); } }
		],
		stats: null,
		slider: null,
		colorPicker: null,
		grid: false,
		style: null,
		onItemChange:null,
		index: 0
	}

}

function paintColorTypeMenu(title, subtitle, action, typebdd){
	return {
		title: "<img src='static/img/header.png'>",
		subtitle: subtitle,
		items: [
			{ key: 'Basic', action: function(){ store.commit('SET_MENU', setColorPickerMenu(title, "Couleurs", action, 0, typebdd))} },
			{ key: 'Metallique', action: function(){ store.commit('SET_MENU', setColorPickerMenu(title, "Couleurs", action, 1, typebdd))} },
			{ key: 'Perl√©e', action: function(){ store.commit('SET_MENU', setColorPickerMenu(title, "Couleurs", action, 2, typebdd))} },
			{ key: 'Matte', action: function(){ store.commit('SET_MENU', setColorPickerMenu(title, "Couleurs", action, 3, typebdd))} },
			{ key: 'Metal', action: function(){ store.commit('SET_MENU', setColorPickerMenu(title, "Couleurs", action, 4, typebdd))} },
			{ key: 'Chrome', action: function(){ store.commit('SET_MENU', setColorPickerMenu(title, "Couleurs", action, 5, typebdd))} },
		],
		stats: null,
		slider: null,
		colorPicker: null,
		grid: false,
		style: null,
		onItemChange:null,
		index: 0,
	}
}

let paint =  {
	title: "<img src='static/img/header.png'>",
	subtitle: 'Peintures',
	limit: 10,
	items: [
		{ key: 'Primaire', action: function(){ store.commit('SET_MENU', paintColorTypeMenu("Primaire", "types", "change_by_colorpicker", 'primary'))}},
		{ key: 'Secondaire', action: function(){ store.commit('SET_MENU', paintColorTypeMenu("Secondaire", "types", "change_by_colorpicker_secondary", 'secondary'))}},
		{ key: 'Perl√©e', value: pearlescentColor,
			onChange: function(index){
				$.post("http://customs/setextracolor", JSON.stringify({color: index}))
			},
			action: function(){
				$.post("http://customs/pay", JSON.stringify({data: 'pearlescent', price: CustomPrice["color"]['pearlescent']  }));
			},
			help: "Prix: <span>" + CustomPrice["color"]['pearlescent'].toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1 ") + "</span> $"
		}
	],
	stats: null,
	slider: null,
	colorPicker: null,
	grid: false,
	style: null,
	onItemChange:null,
	index: 0
};

function perfKitItems(type, id, values) {
    let list = [];
    for (let i = 0; i < values.length; i++) {
        console.log("value "+ i+ "=>"+ values[i].ref);
        list.push({
            key: values[i].n1,
            action: function () {
                $.post('http://customs/pay', JSON.stringify({
                    data: 'performance',
                    type: type,
                    id: id,
                    price: CustomPrice['performance'][type]['val_' + values[i].ref]
                }));
                store.commit('RETURNBACK');
                $.post('http://customs/setperfmod', JSON.stringify({id: values[i].ref - 1, mod: id}))
            },
            help: "Prix: <span>" + CustomPrice['performance'][type]['val_' + values[i].ref].toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1 ") + "</span> $"
        })
    }
    return list;
}


function perfKitChooser(type, id, values) {
	values = values
		.map((value, i) => ({...value, ref: i}))
		.filter((value, index) => (configMods[''+id] || -1) !== (index-1) );
	return {
		title: "<img src='static/img/header.png'>",
		subtitle: "Niveau de performance",
		items: perfKitItems(type, id,values),
		stats: [],
		slider: null,
		colorPicker: null,
		grid: false,
		style: null,
		onItemChange:function(index){ $.post('http://customs/setperfmod', JSON.stringify( {id: values[index].ref -1, mod: id} ) ) },
		index: 0
	}
};

let perfKit = {
	title: "<img src='static/img/header.png'>",
	subtitle: 'Kit performances',
	limit: 10,
	items: [
		{ key: 'Moteur',		action: function(){ store.commit('SET_MENU', perfKitChooser("moteur",11,[{n1: "Stock"}, {n1: "kit evo 1"}, {n1: "kit evo 2"}, {n1: "kit evo 3"}, {n1: "kit evo 4"}]))}},
		{ key: 'Freins',		action: function(){ store.commit('SET_MENU', perfKitChooser("freins",12,[{n1: "Stock"}, {n1: "Street"}, {n1: "Sports"}, {n1: "Race"}]))}},
		{ key: 'Transmission',	action: function(){ store.commit('SET_MENU', perfKitChooser("transmission",13,[{n1: "Stock"}, {n1: "Street"}, {n1: "Sports"}, {n1: "Race"}]))}},
		{ key: 'Suspension',	action: function(){ store.commit('SET_MENU', perfKitChooser("suspension",15, [{n1: "Stock"}, {n1: "Rabaiss√©"}, {n1: "Street"}, {n1: "Sports"}, {n1: "Competition"}]))}},
		{ key: 'Turbo',			action: function(){ store.commit('SET_MENU', perfKitChooser("turbo",18,[{n1: "Aucun"}, {n1: "Install√©"}]))}}
	],
	stats: [],
	slider: null,
	colorPicker: null,
	grid: false,
	style: null,
	onItemChange:null,
	index: 0
};

let neonMenu = {
	title: "<img src='static/img/header.png'>",
	subtitle: 'N√©ons',
	limit: 10,
	items: [
		{ key: 'Install√©', value:[{n1: "Aucun"}, {n1: "Oui"}],
			help:"Prix: <span>" + CustomPrice["color"]['neons'].toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1 ") + "</span> $",
			onChange: function(index){ $.post('http://customs/setneonactive', JSON.stringify({enabled: index}))},
			action:function(){ $.post('http://customs/pay', JSON.stringify({data: 'neons',price: CustomPrice["color"]['neons']}))} },
		{ key: 'Couleurs', action: function(){ store.commit('SET_MENU', setColorPickerMenu("N√©ons", "Couleurs", 'setneoncolor', 0, 'neons'))} }
	],
	stats: null,
	slider: null,
	colorPicker: null,
	grid: false,
	style: null,
	onItemChange:null,
	index: 0
};

let tyreColorMenu = {
	title: "<img src='static/img/header.png'>",
	subtitle: 'Couleur fum√©e des pneux',
	limit: 10,
	items: [
		{ key: 'Install√©', value:[{n1: "Aucun"}, {n1: "Oui"}],
			help:"Prix: <span>" + CustomPrice['tyreburst'].toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1 ") + "</span> $",
			onChange: function(index){ $.post('http://customs/settyreburst', JSON.stringify({enabled: index}))},
            action: function() {  $.post('http://customs/pay', JSON.stringify({data: 'tyreburst', price: CustomPrice['tyreburst']})) }
        },
		{ key: 'Couleurs', action: function(){ store.commit('SET_MENU', setColorPickerMenu("Couleur de la fum√©e", "Couleurs", 'settyreburstcolor', 0,'tyreburst' ))} }
	],
	stats: null,
	slider: null,
	colorPicker: null,
	grid: false,
	style: null,
	onItemChange:null,
	index: 0
};

let tyreSelectionMenu = {
	title: "<img src='static/img/header.png'>",
	subtitle: 'Type de jantes',
	limit: 10,
	items: [],
	stats: null,
	slider: null,
	colorPicker: null,
	grid: false,
	style: null,
	onItemChange: function(index){ $.post('http://customs/settyreselection', JSON.stringify({id: index }))},
	index: 0
};

let tyreJantesMenu = {
	title: "<img src='static/img/header.png'>",
	subtitle: 'Categorie de jantes',
	limit: 10,
	items: [
		{ key: 'Sport', action: function(){  store.commit('SET_MENU', tyreSelectionMenu); $.post('http://customs/gettyreselection', JSON.stringify({type: 0}))}},
		{ key: 'Muscle', action: function(){  store.commit('SET_MENU', tyreSelectionMenu); $.post('http://customs/gettyreselection', JSON.stringify({type: 1}))}},
		{ key: 'Lowrider', action: function(){  store.commit('SET_MENU', tyreSelectionMenu); $.post('http://customs/gettyreselection', JSON.stringify({type: 2}))}},
		{ key: 'SUV', action: function(){  store.commit('SET_MENU', tyreSelectionMenu); $.post('http://customs/gettyreselection', JSON.stringify({type: 3}))}},
		{ key: 'Offroad', action: function(){  store.commit('SET_MENU', tyreSelectionMenu); $.post('http://customs/gettyreselection', JSON.stringify({type: 4}))}},
		{ key: 'Tuner', action: function(){ store.commit('SET_MENU', tyreSelectionMenu); $.post('http://customs/gettyreselection', JSON.stringify({type: 5}))}},
		{ key: 'Bike Wheels', action: function(){ store.commit('SET_MENU', tyreSelectionMenu); $.post('http://customs/gettyreselection', JSON.stringify({type: 6}))}},
		{ key: 'High End', action: function(){  store.commit('SET_MENU', tyreSelectionMenu); $.post('http://customs/gettyreselection', JSON.stringify({type: 7}))}}
	],
	stats: null,
	slider: null,
	colorPicker: null,
	grid: false,
	style: null,
	onItemChange:null,
	index: 0
};

let tyreMenu = {
	title: "<img src='static/img/header.png'>",
	subtitle: 'Pneumatiques',
	limit: 10,
	items: [
		{ key: 'Couleurs de la fum√©e des pneux', action: function(){ store.commit('SET_MENU', tyreColorMenu)}},
		{ key: 'Jantes', action: function(){ store.commit('SET_MENU', tyreJantesMenu)}}
	],
	stats: null,
	slider: null,
	colorPicker: null,
	grid: false,
	style: null,
	onItemChange:null,
	index: 0
};

let bodyKit = {
	title: "<img src='static/img/header.png'>",
	subtitle: 'Kit esthetique',
	limit: 10,
	items: [
		{ key: 'N√©ons', action: function(){ store.commit('SET_MENU', neonMenu)}},
		{ key: 'Feux Xenon', value:[{n1: "Non"}, {n1: "Oui"}],
			help:"Prix: <span>" + CustomPrice['xenons'].toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1 ") + "</span> $",
			onChange: function(index){ $.post('http://customs/changebodymod', JSON.stringify({id: index, mod: 22}))},
			action:function(){ $.post('http://customs/pay', JSON.stringify({data: 'xenons', price: CustomPrice['xenons']}))}
		},
		{ key: 'Klaxon', value:itemArray(51),
			onChange: function(index){ $.post('http://customs/changebodymod', JSON.stringify({id: index, mod: 14}))},
			help:"Prix: <span>" + CustomPrice['horn'].toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1 ") + "</span> $",
			action:function(){ $.post('http://customs/pay', JSON.stringify({data: 'horn', price: CustomPrice['horn']}))}
		},
		{ key: 'Fen√™tres', value:[{n1: 'stock'}, {n1: 'Noir 100%'}, {n1:'Noir 75%'}, {n1: 'Noir 50%'}, {n1:'Noir 20%'}, {n1:'Limonade'}],
			help:"Prix: <span>" + CustomPrice['windows'].toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1 ") + "</span> $",
			onChange: function(index){ $.post('http://customs/set_custom_window_tint', JSON.stringify({id: index}))},
			action:function(){ $.post('http://customs/pay', JSON.stringify({data: 'windows', price: CustomPrice['windows']}))}
		}
	],
	stats: null,
	slider: null,
	colorPicker: null,
	grid: false,
	style: null,
	onItemChange:null,
	index: 0
};

let main =  {
	title: "<img src='static/img/header.png'>",
	subtitle: 'Cat√©gories',
	limit: 10,
	items: [
		{ key: 'Peintures', value:'<img src="static/img/paint.png" />', action: function(){ store.commit('SET_MENU', paint)}},
		{ key: 'Esthetique', value:'<img src="static/img/kit.png" />', action: function(){ store.commit('SET_MENU', bodyKit); $.post('http://customs/getbodymodlist', JSON.stringify({}))}},
		{ key: 'Pneumatiques', value:'<img src="static/img/wheel.png" />', action: function(){ store.commit('SET_MENU', tyreMenu);}},
		{ key: 'Performances', value:'<img src="static/img/engine.png" />', action: function(){ store.commit('SET_MENU', perfKit); $.post('http://customs/getperflist', JSON.stringify({}))}},
		{ style: 'red button', key: 'Fermer', action: function(){ $.post('http://customs/close', JSON.stringify({})); }}
	],
	stats: null,
	slider: null,
	colorPicker: null,
	grid: false,
	style: null,
	onItemChange:null,
	index: 0
};

$(document).ready(function(){
	store.commit('SET_MENU', main);
	store.commit('TOGGLE_MENU', false);
});

this.message = function (e) {
	let data = e.detail || e.data;
	if (data.openUI === true) {
		store.commit('TOGGLE_MENU', true);
		$.post("http://customs/init", JSON.stringify({}))
	}
    if (data.pause === true) {
        $('.debug').fadeOut();
    } else {
        $('.debug').fadeIn();
    }
	if (data.closeUI === true) {
		store.commit('TOGGLE_MENU', false);
		store.commit('RETURN_BACK');
		store.commit('RETURN_BACK');
		store.commit('RETURN_BACK');
		store.commit('RETURN_BACK');
		store.commit('RETURN_BACK');
		store.commit('RETURN_BACK');
	}
	if (data.addmodlist) {
		let row = JSON.parse(data.addmodlist);
		row.list.unshift({n1:'Base'});
		store.commit('ADD_ITEM', {
			visible: row.visible,
			key: row.name,
			help: "Prix: <span>" + CustomPrice['mods']['mod_'+row.mod].toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1 ") + "</span> $",
			value: row.list,
			onChange: function(index){ $.post('http://customs/changebodymod', JSON.stringify({id: index, mod: row.mod})) },
			action: function(){ $.post('http://customs/pay', JSON.stringify({ data: row.mod, price: CustomPrice['mods']['mod_'+row.mod] })) }
		})
	}
	if (data.addextra) {
		let row = JSON.parse(data.addextra);
		store.commit('ADD_ITEM', {
			visible: true,
			key: row.name,
			help: "Prix: <span>" + 400 + "</span> $",
			value: row.list,
			onChange: function(index){ $.post('http://customs/extra', JSON.stringify({id: index })) },
			action: function(){ $.post('http://customs/pay', JSON.stringify({ data: row.extraNo, price: 400 })) }
		})
	}
	if (data.addtyrelist) {
		let row = JSON.parse(data.addtyrelist);
		if (row.name.n1 == null ) {
			alert(row.name.n1)
		}
		store.commit('ADD_ITEM', {
			visible: row.visible,
			key: row.name.n1,
			value: pearlescentColor,
			help: "Prix: <span>" + CustomPrice['wheels']['val_'+row.type].toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1 ") + "</span> $",
			onChange:  function(index){ $.post('http://customs/setwheelcolor', JSON.stringify({color: index })) },
            action: function(){ $.post('http://customs/pay', JSON.stringify({ data: 'wheels', price: CustomPrice['wheels']['val_'+row.type]})) }
		})
	}
	if (data.resetstats) {
		store.commit('RESET_STATS', {});
	}
	if (data.config) {
		console.log(data.config)
		configMods = JSON.parse(data.config);
	}
	if (data.setperfstats) {
		let row = JSON.parse(data.setperfstats);
		if (row.name == 'Acceleration'){
			row.value = (( Math.round(row.value * 100) ) / 75) * 100;
		} else {
			row.value = (( Math.round(row.value * 100) ) / 150) * 100;
		}
		store.commit('ADD_STATS', {
			name: row.name,
			levels: 5,
			value: row.value,
			width: 360,
		});
	}
}.bind(this);
window.addEventListener('message', this.message);

this.listener = function (e) {
    if (e.key === 'ArrowDown' || e.key === 'ArrowUp'|| e.key === 'ArrowLeft'|| e.key === 'ArrowRight' || e.key === 'Enter'){
        $.post('http://customs/nav', JSON.stringify({}));
    }
	if (e.key === 'H' || e.key === 'h'){
		$.post('http://customs/opendoors', JSON.stringify({}));
	}
	if (e.key === 'V' || e.key === 'v'){
		$.post('http://customs/changeview', JSON.stringify({}));
	}
}.bind(this);
window.addEventListener('keyup', this.listener);
